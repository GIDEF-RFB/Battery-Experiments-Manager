{% extends "base.html" %}
{% load static %}

{% block page_content %}

    <style>
        #background-image {
            /*width: 50%;*/
            width: 85%;
            opacity: 0.25;
            -webkit-backface-visibility: hidden; 
            -ms-transform: translateZ(0); /* IE 9 */
            -webkit-transform: translateZ(0); /* Chrome, Safari, Opera */
            transform: translateZ(0);
            max-width: 500px;
            max-height: 756px;
            transform-origin: 50% 50%;
            -webkit-animation: blink-1 15s linear infinite both;
                    animation: blink-1 15s linear infinite both;
            -webkit-user-select: none; /* Chrome all / Safari all */
            -moz-user-select: none; /* Firefox all */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Likely future */
        }

        /*#background-image:hover {
            -webkit-animation: rotation 0.1s linear infinite;
                    animation: rotation 0.1s linear infinite;
        }*/

        .details-column {
            column-count: 2;
            column-gap: 30px;
        }
        .details-column p {
            break-inside: avoid;
        }



        /* ----------------------------------------------
        * Generated by Animista on 2023-8-22 11:43:42
        * Licensed under FreeBSD License.
        * See http://animista.net/license for more info. 
        * w: http://animista.net, t: @cssanimista
        * ---------------------------------------------- */

        /**
        * ----------------------------------------
        * animation blink-1
        * ----------------------------------------
        */
        @-webkit-keyframes blink-1 {
        0%,
        50%,
        100% {
            opacity: 0.20;
            transform: scale(1);
        }
        25%,
        75% {
            opacity: 0.08;
            transform: scale(0.98);
        }
        }
        @keyframes blink-1 {
        0%,
        50%,
        100% {
            opacity: 0.20;
            transform: scale(1);
        }
        25%,
        75% {
            opacity: 0.08;
            transform: scale(0.98);
        }
        }

        @keyframes rotation {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(359deg);
            }
        }


    </style>

    <div class="container-fluid">
        <div class="row" style="height: 90vh;">
            <div class="col-md-4 col-lg-3 col-xl-2">
                <div class="vLeftMenu bg-light text-capitalize">

                    <ul class="vLeftMenu">
                        {% for exp in experiments %}
                            <a class="" href="{% url 'exp_info_select' exp.exp_id %}">
                                <li class="vLeftMenu On" {% if exp.exp_id == id_selected %}id="myActiveVLeftMenu"{% endif %}>
                                    <span>{{ exp.name }}</span>
                                </li>
                            </a>
                        {% endfor %}
                    </ul>

                </div>
            </div>

            <div class="col-md-8 col-lg-9 col-xl-10" id="mainPanel">
                <div class="bg-light mainPanel">
                    {% if exp_selected %}
                        <div class="details-column">
                            <h2>Experiment Details</h2>
                            <p id="ExpID"><strong>ID:</strong> {{ exp_selected.exp_id }}</p>
                            <p><strong>Name:</strong> {{ exp_selected.name }}</p>
                            <p id="ExpDescription"><strong>Description:</strong> {{ exp_selected.description }}</p>
                            <p><strong>Creation Date:</strong> {{ exp_selected.date_creation }}</p>
                            <p><strong>Begin Date:</strong> {{ exp_selected.date_begin }}</p>
                            <p><strong>End Date:</strong> {{ exp_selected.date_finish }}</p>
                            <p><strong>Status:</strong> {{ exp_selected.status }}</p>
                            <p><strong>Cycler Station located at:</strong> {{ cycler_station_info.location }}</p>
                            <p><strong>Using Battery:</strong> {{ battery_info.name }}</p>
                            <p><strong>Profile:</strong> {{ profile_info.name }}</p>
                            {% if electrolyte_info %}
                                <h3>Electrolyte Information</h3>     
                                <p><strong>Volumen in each tank:</strong> {{ electrolyte_info.electrolyte_vol }}</p>
                                <p><strong>Initial SOC:</strong> {{ electrolyte_info.initial_soc     }}</p>
                                <p><strong>Flow rate Range expected:</strong> {{ electrolyte_info.min_flow_rate   }} - {{ electrolyte_info.max_flow_rate   }}</p>
                            {% endif %}
                        </div>
                        <div class="row">
                            <div class="col-1 col-lg-7">
                                <button type="button" id="btnChange" class="btn btn-primary" style="margin-bottom: 20px;">Modify Description</button>
                            </div>
                        </div>
                    {% else %}
                        <img draggable="false" id="background-image" src="{% static 'images/WATREX_LOGO_no_color.svg' %}" alt="background_image">
                    {% endif %}
                </div>

            </div>
        </div>
    </div>


    <script type="text/javascript" src="{% static 'bootstrap-select.min.js'%} "></script>   {#  https://developer.snapappointments.com/bootstrap-select/  #}

    <script>
    /* ___   ___   _   _   ___   _____  _____ ______  _____ ______  _____
  |_  | / _ \ | | | | / _ \ /  ___|/  __ \| ___ \|_   _|| ___ \|_   _|
    | |/ /_\ \| | | |/ /_\ \\ `--. | /  \/| |_/ /  | |  | |_/ /  | |
    | ||  _  || | | ||  _  | `--. \| |    |    /   | |  |  __/   | |
/\__/ /| | | |\ \_/ /| | | |/\__/ /| \__/\| |\ \  _| |_ | |      | |
\____/ \_| |_/ \___/ \_| |_/\____/  \____/\_| \_| \___/ \_|      \_/  */
    const btnChangeDescription = document.getElementById("btnChange");
    btnChangeDescription.addEventListener("click", change_description);
    const exp_description = document.getElementById("ExpDescription").innerHTML.toString().split("</strong>")[1];
    const exp_id = document.getElementById("ExpID").innerHTML.toString().split("</strong>")[1];

    function change_description() {
        console.log(exp_id);
        console.log(exp_description);
        // let exp_id = document.getElementById("ExpID").innerHTML.split(": ")[1];
        // let exp_description = document.getElementById("ExpDescription").value;
        let custom_description = prompt("Enter the new experiment description", exp_description);
        if (custom_description != null){
            while (custom_description.length > 250) {
                console.log(custom_description.length);
                alert("❌ Description too long. Please enter a description with less than 250 characters.");
                custom_description = prompt("Enter the new experiment description", custom_description.slice(0,250));
            }
            console.log(custom_description);
            $.ajax({
                async: false,
                type: "POST",
                url: "{% url 'change-exp-description' %}",
                // contentType: "application/json; charset=utf-8",
                data: { csrfmiddlewaretoken: '{{ csrf_token }}',
                        exp_id: exp_id,
                        exp_description: custom_description,
                    },
                success:  function(response){
                    response = JSON.parse(response);
                    if (response.status == "OK") {
                        alert("✅ Experiment description changed successfully");
                        location.reload(); // TODO: Change to redirect to add_experiment view
                    } else {
                        alert("❌ Error changing description. Please try again.");
                    }
                },
                error: function(response) {
                    alert("ERROR");
                }
            });
        }

    }
    </script>
{% endblock %}
